<h1> 인터페이스는 구현하는 쪽을 생각해 설계하라.</h1>
- 자바8 이전에는 기존 구현체를 깨뜨리지 않고는 인터페이스에 메서드를 추가할 방법이 없었다.  <br/>
- 인터페이스에 메서드를 추가하면 보통은 컴파일 오류가 나는데, 추가된 메서드가 우연히 기존 구현체에 이미 존재할 가능성이 아주 낮기 때문이다.  <br/>
- 자바 8 와서는 기존 인터페이스에 메서드를 추가할수 있도록 디폴트 메서드를 소개했지만, 위험이 완전히 사라진 것은 아니다.  <br/>
- 디폴트 메서드 선언후에는 그 인터페이스를 구현하는 디폴트 메서드를 재정의하지 않은 모든 클레스에서 디폴트 구현이 쓰이게 됨  <br/>
- 합의없이 디폴트 메서드는 구현 클레스에 대해 아무것도 모른 채 무작정 '삽입'된 뿐이다.  <br/><br/>

자바 8의 Collection 인터페이스에 추가된 removeIf 메서드를 예로 생각해보자.
```
default boolean removeIf(Predicate<? super E> filter) { 
  Objects.requireNonNull(filter); ←  filter가 null 이 아닌지 
  
  boolean result = false; 
  for (Iterator<E> it = iterator(); it.hasNext(); ) {
    if (filter.test(it.next()) { ← iterator가 수행되면서 불리언 프레디테이트가 true를 반환하면
      it.remove();  ← 모든 it를 제거하고
      result = true; ← true를 반환한다.
    } 
  } 
  return result; 
}

```

아파치 커먼즈 라이브러리의 이 클래스는 java.util의 Collections.synchronized Collection 정적 팩터리 메서드가 반환하는 클래스와 비슷하다. <br/>
아파치 버전은 클라이언트가 제공한 객체로 락을 거는 능력을 추가로 제공한다. <br/>
즉, 모든 메서드에서 주어진 락 객체로 동기화한 후 내부 컬렉션 객체에 기능을 위임하는 래퍼 클래스다.<br/>
<br/>
아파치의 SynchronizedCollection 클래스는 지금도 활발히 관리되고 있지만 removeIf 메서드를 재정의하지 않고 있다.<br/>
이 클래스를 자바 8과 함께 사용한다면(그래서 removeIf의 디폴트 구현을 물려받게 된다면), 자신이 한 약속을 더 이상 지키지 못하게 된다.<br/>
다시 말해 모든 메서드 호출 알아서 동기화해주지 못한다.<br/>
removeIf의 구현은 동기화에 관해 아무것도 모르므로 락 객체를 사용할 수 없다.<br/><br/>
따라서 SynchronizedCollection 인스턴스를 여러 스레드가 공유하는 환경에서 환경에서 한 스레드가 removeIf를 호출하면 ConrrentModificationException이 발생하거나 다른 예기치 못한 결과로 이어질 수 있다.<br/>

<br/>

<h3>일련의 조치</h3>
자바 플랫폼 라이브러리에서는 이런 문제를 예방하기 위해 일련의 조치를 취했다.<br/>
예를 들어, 1) 구현한 인터페이스의 디폴트 메서드를 재정의하고 2) 다른 메서드에서는 디폴트 메서드를 호출하기 전에 필요한 작업을 수행하도록 했다.<br/>

예컨대 Collections.synchronizedCollection이 반환하는 package-private 클래스들은 removeIf를 재정의하고, <br/>
이를 호출하는 다른 메서드들을 디폴트 구현을 호출하기 전에 동기화를 하도록 했다. <br/>
하지만 자바 플랫폼에 속하지 않은 제3의 기존 컬렉션 구현체들은 이런 언어 차원의 인터페이스 변화에 발맞춰 수정될 기회가 없었으면, 그중 일부는 여전히 수정되지 않고 있다.<br/>

<b>흔한 일은 아니지만,  디폴트 메서드는 컴파일에 성공하더라도 기존 구현체에 런타임 오류를 일으킬 수 있다. </b>
따라서 기존 인터페이스에 디폴트 메서드로 새 메서드를 추가하는 일은 꼭 필요한 경우가 아니면 피해야 한다.<br/>

<h3> 정리</h3>
- 인터페이스를 설계할는 '세심한 주의'를 기울여야한다.<br/>
- 디폴트 메서드로 기존 인터페이스에 새로운 메서드를 추가하면 커다란 위험도 딸려온다.<br/>
- 새로운 인터페이스라면 릴리스 전에 반드시 테스트를 거쳐야한다. <br/>




